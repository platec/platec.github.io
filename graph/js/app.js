(function(){"use strict";var e={759:function(e,t,i){var s=i(963),n=i(252);const a={class:"container"};function r(e,t,i,s,r,o){return(0,n.wg)(),(0,n.j4)("div",a)}class o{}Object.defineProperty(o,"defaultBorderColor",{enumerable:!0,configurable:!0,writable:!0,value:"#979797"}),Object.defineProperty(o,"defaultBackgroundColor",{enumerable:!0,configurable:!0,writable:!0,value:"transparent"}),Object.defineProperty(o,"defaultBorderWidth",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(o,"defaultFont",{enumerable:!0,configurable:!0,writable:!0,value:"12px arial, sans-serif"}),Object.defineProperty(o,"defaultAlign",{enumerable:!0,configurable:!0,writable:!0,value:"left"}),Object.defineProperty(o,"defaultVAlign",{enumerable:!0,configurable:!0,writable:!0,value:"middle"}),Object.defineProperty(o,"defaultBorderJoin",{enumerable:!0,configurable:!0,writable:!0,value:"round"}),Object.defineProperty(o,"defaultBorderCap",{enumerable:!0,configurable:!0,writable:!0,value:"butt"}),Object.defineProperty(o,"defaultFillRule",{enumerable:!0,configurable:!0,writable:!0,value:"evenodd"}),Object.defineProperty(o,"defaultFontColor",{enumerable:!0,configurable:!0,writable:!0,value:"black"}),Object.defineProperty(o,"defaultText",{enumerable:!0,configurable:!0,writable:!0,value:"graph"});class l{constructor(){Object.defineProperty(this,"dataModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Data"}),Object.defineProperty(this,"_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}get id(){return this._id}set id(e){this._id=e}update(){this.dataModel&&this.dataModel.emitNextTick("renderAll")}}class h extends l{constructor(){super(),Object.defineProperty(this,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Node"}),Object.defineProperty(this,"_x",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_y",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_width",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_height",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_image",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_displayName",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_symbolLoaded",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_styleMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}get x(){return this._x}set x(e){this._x=e,this.update()}get y(){return this._y}set y(e){this._y=e,this.update()}get width(){return this._width}set width(e){this._width=e,this.update()}get height(){return this._height}set height(e){this._height=e,this.update()}get image(){return this._image}set image(e){this.symbolLoaded=!1,this._image=e,this.update()}get displayName(){return this._displayName}set displayName(e){this._displayName=e}get symbolLoaded(){return this._symbolLoaded}set symbolLoaded(e){this._symbolLoaded=e}getBounds(){return{x:this.x-this.width/2,y:this.y-this.height/2,width:this.width,height:this.height}}setStyle(e,t){if(void 0!==t&&"string"===typeof e&&this._styleMap.set(e,t),e&&Object.keys(e).length>0)for(const i in e)this._styleMap.set(i,e[i]);this.update()}getStyle(e){return this._styleMap.get(e)}}class c extends l{constructor(){super(),Object.defineProperty(this,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Text"}),Object.defineProperty(this,"_x",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_y",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_width",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_height",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_styleMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}get x(){return this._x}set x(e){this._x=e,this.update()}get y(){return this._y}set y(e){this._y=e,this.update()}get width(){return this._width}set width(e){this._width=e,this.update()}get height(){return this._height}set height(e){this._height=e,this.update()}getBounds(){return{x:this.x-this.width/2,y:this.y-this.height/2,width:this.width,height:this.height}}setStyle(e,t){if(void 0!==t&&"string"===typeof e&&this._styleMap.set(e,t),e&&Object.keys(e).length>0)for(const i in e)this._styleMap.set(i,e[i]);this.update()}getStyle(e){return this._styleMap.get(e)}}class d extends l{constructor(){super(),Object.defineProperty(this,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Shape"}),Object.defineProperty(this,"_x",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_y",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_width",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_height",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_closePath",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_styleMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"_segments",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_points",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get x(){return this._x}set x(e){this._x=e,this.update()}get y(){return this._y}set y(e){this._y=e,this.update()}get width(){return this._width}set width(e){this._width=e,this.update()}get height(){return this._height}set height(e){this._height=e,this.update()}get segments(){return this._segments}set segments(e){this._segments=e,this.update()}get points(){return this._points}set points(e){this._points=e,this.update()}get closePath(){return this._closePath}set closePath(e){this._closePath=e,this.update()}getBounds(){return{x:this.x-this.width/2,y:this.y-this.height/2,width:this.width,height:this.height}}setStyle(e,t){if(void 0!==t&&"string"===typeof e&&this._styleMap.set(e,t),e&&Object.keys(e).length>0)for(const i in e)this._styleMap.set(i,e[i]);this.update()}getStyle(e){return this._styleMap.get(e)}}var u=function(e,t,i,s){function n(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function r(e){try{l(s.next(e))}catch(t){a(t)}}function o(e){try{l(s["throw"](e))}catch(t){a(t)}}function l(e){e.done?i(e.value):n(e.value).then(r,o)}l((s=s.apply(e,t||[])).next())}))};const f={imageCache:{},setImage:g,drawNodeImage:B,getImage:b,loadImage:y,load:m,loadSymbol:p,convertURL:e=>e,unionPoint:v};function g(e,t){f.imageCache[e]=t}function b(e){return f.imageCache[e]}function y(e){return u(this,void 0,void 0,(function*(){const t=e.map((e=>new Promise((t=>{const i=new Image;i.onload=()=>{e.name.startsWith("data:image")?g(e.displayName,i):g(e.name,i),t()},e.name.startsWith("data:image")?i.src=e.name:i.src=f.convertURL(e.name)}))));return Promise.all(t)}))}function p(e){return u(this,void 0,void 0,(function*(){const t=e.map((e=>new Promise((t=>u(this,void 0,void 0,(function*(){const i=yield m(e);g(e,i),t()}))))));return Promise.all(t)}))}function m(e){return u(this,void 0,void 0,(function*(){const t=f.convertURL(e),i=yield fetch(t,{method:"GET"}),s=yield i.json();return s}))}function v(e,t){return e&&t?{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),width:Math.abs(e.x-t.x),height:Math.abs(e.y-t.y)}:null}var w=f;function _(e,t,i){if(i)e.fillStyle=i.background||o.defaultBackgroundColor,e.strokeStyle=i.borderColor||o.defaultBorderColor,void 0!==i.borderWidth&&(e.lineWidth=i.borderWidth),e.lineJoin=i.borderJoin||o.defaultBorderJoin,e.lineCap=i.borderCap||o.defaultBorderCap;else{const i=t;e.fillStyle=i.getStyle("shape.background")||o.defaultBackgroundColor,e.strokeStyle=i.getStyle("shape.border.color")||o.defaultBorderColor;const s=i.getStyle("shape.border.width");void 0!==s&&(e.lineWidth=s),e.lineJoin=i.getStyle("shape.border.join")||o.defaultBorderJoin,e.lineCap=i.getStyle("shape.border.cap")||o.defaultBorderCap}}function x(e,t,i){if(i)void 0!==i.borderWidth&&e.stroke();else{const i=t,s=i.getStyle("shape.border.width");void 0!==s&&e.stroke()}e.fill()}function P(e,t,i){let s,n,a,r;if(e.save(),i)[s,n,a,r]=i.rect;else{const e=t;s=0,n=0,({width:a,height:r}=e)}_(e,t,i),e.beginPath(),e.rect(s,n,a,r),e.closePath(),x(e,t,i),e.restore()}function O(e,t,i){let s,n,a,r;if(e.save(),i)[s,n,a,r]=i.rect;else{const e=t;s=0,n=0,({width:a,height:r}=e)}_(e,t,i);const o=Math.min(a,r)/2;e.beginPath(),e.arc(s+a/2,n+r/2,o,0,2*Math.PI,!0),e.closePath(),x(e,t,i),e.restore()}function j(e,t,i){let s,n,a,r;if(e.save(),i)[s,n,a,r]=i.rect;else{const e=t;s=0,n=0,({width:a,height:r}=e)}const o=a/2,l=r/2;e.beginPath();const h=l/o;o!==l&&e.scale(1,h),e.arc(s+o,(n+l)/h,o,0,2*Math.PI,!0),e.closePath(),e.restore(),e.save(),_(e,t,i),x(e,t,i),e.restore()}const S=function(){const e={},t=document.createElement("canvas").getContext("2d");return function(i,s){t.font=i;let n=e[t.font];return n||(n=2*t.measureText("e").width+4,e[t.font]=n),{width:t.measureText(s).width+4,height:n}}}();function M(e,t,i){let s,n,a,r,l,h,c,d,u;if(e.save(),i)[s,n,a,r]=i.rect,({text:l,font:h,color:c,align:d,vAlign:u}=i);else{const e=t;s=0,n=0,({width:a,height:r}=e),l=e.getStyle("text"),h=e.getStyle("text.font"),c=e.getStyle("text.color"),d=e.getStyle("text.align"),u=e.getStyle("text.vAlign")}e.font=h||o.defaultFont;const f=S(e.font,l);e.textAlign="center",e.textBaseline="middle",e.fillStyle=c||o.defaultFontColor,u=u||o.defaultVAlign,d=d||o.defaultAlign,c=c||o.defaultFontColor,l=l||o.defaultText;let g=0,b=0;b="top"===u?n+f.height/2:"middle"===u?n+r/2:n+r-f.height/2,g="right"===d?s+a-f.width/2:"left"===d?s+f.width/2:s+a/2,e.fillText(l,g,b),e.restore()}function k(e,t){const i=t,s=i.getSource(),n=i.getTarget();if(s&&n){e.save(),e.beginPath(),e.strokeStyle=i.getStyle("edge.color")||o.defaultBorderColor;const t=i.getStyle("edge.width")||o.defaultBorderWidth,a=(i.getStyle("edge.cap"),i.getStyle("edge.join"));e.lineJoin=a||o.defaultBorderJoin,e.lineWidth=t<=0?1:t;const r={x:s.x,y:s.y},l={x:n.x,y:n.y},h=i.getStyle("edge.segments");if(h){const t=[...i.getStyle("edge.points")];t.unshift(r),t.push(l);const s=h.length;for(let i=0,n=0;i<s;i++){const s=h[i];if(1===s){const i=t[n++];e.moveTo(i.x,i.y)}else if(2===s){const i=t[n++];e.lineTo(i.x,i.y)}else if(3===s){const i=t[n++],s=t[n++];e.quadraticCurveTo(i.x,i.y,s.x,s.y)}else if(4===s){const i=t[n++],s=t[n++],a=t[n++];e.bezierCurveTo(i.x,i.y,s.x,s.y,a.x,a.y)}}}else e.moveTo(r.x,r.y),e.lineTo(l.x,l.y);e.stroke(),e.restore()}}function T(e,t,i){let s,n,a,r,o,l,h;if(e.save(),i)[s,n,a,r]=i.rect,({name:o,displayName:l}=i);else{const e=t;s=0,n=0,({width:a,height:r,image:o,displayName:l}=e)}h=o.startsWith("data:image")?l:o;const c=w.getImage(h);c&&e.drawImage(c,s,n,a,r),e.restore()}function A(e){const t=[],i=e.length;for(let s=0;s<i;s+=2)t.push({x:e[s],y:e[s+1]});return t}function C(e,t,i){let s,n,a;if(e.save(),i)({segments:s,closePath:n}=i),a=A(i.points);else{const e=t;a=e.points,s=e.segments,n=e.closePath}if(_(e,t,i),e.beginPath(),s&&s.length>0){const t=s.length;for(let i=0,r=0;i<t;i++){const t=s[i];if(1===t){const t=a[r++];e.moveTo(t.x,t.y)}else if(2===t){const t=a[r++];e.lineTo(t.x,t.y)}else if(3===t){const t=a[r++],i=a[r++];e.quadraticCurveTo(t.x,t.y,i.x,i.y)}else if(4===t){const t=a[r++],i=a[r++],s=a[r++];e.bezierCurveTo(t.x,t.y,i.x,i.y,s.x,s.y)}else 5===t&&e.closePath();n&&e.closePath()}}else{const t=a.length;if(t>0){let i=a[0];e.moveTo(i.x,i.y);for(let s=1;s<t;s++){const t=a[s];e.lineTo(t.x,t.y)}n&&e.closePath()}}const r=t,l=(i?i.borderWidth:r.getStyle("shape.border.width"))||0;0!==l&&(e.lineWidth=l,e.stroke());const h=i?i.background:r.getStyle("shape.background"),c=(i?i.fillRule:r.getStyle("shape.fill.rule"))||o.defaultFillRule;h&&e.fill(c),e.restore()}function N(e,t,i){let s,n,a,r;if(e.save(),i)[s,n,a,r]=i.rect;else{const e=t;s=0,n=0,({width:a,height:r}=e)}_(e,t,i),e.beginPath(),e.moveTo(s+a/2,n),e.lineTo(s+a,n+r),e.lineTo(s,n+r),e.lineTo(s+a/2,n),e.closePath(),e.stroke(),e.fill(),e.restore()}function I(e,t,i){let s,n,a,r,o,l,h;if(e.save(),i)[s,n,a,r]=i.rect,({arcFrom:o,arcTo:l,arcClose:h}=i);else{const e=t;s=0,n=0,({width:a,height:r}=e),o=e.getStyle("shape.arc.from"),l=e.getStyle("shape.arc.to"),h=e.getStyle("shape.arc.close")}const c=Math.min(a,r)/2;_(e,t,i),e.beginPath();const d=s+a/2,u=n+r/2;e.arc(d,u,c,o,l),void 0!==h&&!0!==h||(e.lineTo(d,u),e.closePath()),x(e,t,i),e.restore()}function L(e,t,i){const s=t;if(i){const t=s.width||i.width,n=s.height||i.height;e.translate(s.x-t/2,s.y-n/2);const a=t/i.width,r=n/i.height;e.scale(a,r)}else e.translate(s.x-s.width/2,s.y-s.height/2)}function B(e,t,i,s){const n=i;if(!n.width||!n.height)return;const a=e.context;if(a.save(),s){const e=s.comps;if(e){L(a,i,s);for(let t of e)W(a,i,t.type,t)}}else{const e=n.getStyle("shape");L(a,i),e?W(a,i,e):T(a,i)}a.restore()}function E(e,t){e.save(),L(e,t),M(e,t),e.restore()}function W(e,t,i,s){switch(i){case"rect":P(e,t,s);break;case"circle":O(e,t,s);break;case"oval":j(e,t,s);break;case"text":M(e,t,s);break;case"image":T(e,t,s);break;case"shape":C(e,t,s);break;case"triangle":N(e,t,s);break;case"arc":I(e,t,s);break}}function z(e,t){if(!t.width||!t.height)return;const{x:i,y:s,width:n,height:a}=t,r=e.context;r.save(),r.beginPath(),r.rect(i-n/2,s-a/2,n,a),r.lineWidth=1,r.strokeStyle="#60ACFC",r.stroke(),r.closePath(),r.restore()}function R(e,t){let i,s;return t.pageX||t.pageY?(i=t.pageX,s=t.pageY):(i=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,s=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),i-=e.offsetLeft,s-=e.offsetTop,{x:i,y:s}}function D(e,t,i){return!(t<e.x||t>e.x+e.width||i<e.y||i>e.y+e.height)}function F(e){const t=e.p,{position:i,width:s,height:n,image:a,displayName:r}=t,o=new h;if(o.id=e.i,o.x=i.x,o.y=i.y,o.width=s,o.height=n,o.displayName=r,a)o.image=a;else{const t=e.s;o.setStyle(t)}return o}function J(e){const t=e.p,{position:i,width:s,height:n}=t,a=new c;a.id=e.i,a.x=i.x,a.y=i.y,a.width=s,a.height=n;const r=e.s;return a.setStyle(r),a}function q(e){const t=e.p,{position:i,width:s,height:n,segments:a,points:r,closePath:o}=t,l=new d;l.id=e.i,l.segments=a.__a,l.points=r.__a,l.closePath=o,l.x=i.x,l.y=i.y,l.width=s,l.height=n;const h=e.s;return l.setStyle(h),l}const U=(()=>{let e=0;return()=>++e})();function V(e){return e instanceof G}class G{constructor(e){Object.defineProperty(this,"_datas",{enumerable:!0,configurable:!0,writable:!0,value:[]});const t=arguments.length;if(1===t){const e=arguments[0];if(V(e)){const t=e.size();for(let i=0;i<t;i++)this._datas.push(e.get(i))}else if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++)this._datas.push(e[i])}else null!==e&&this._datas.push(e)}else if(t>1)for(let i=0;i<t;i++)this._datas.push(arguments[i])}push(...e){const t=e.length;for(let i=0;i<t;i++)this.add(e[i])}pop(){return this._datas.pop()}shift(){return this._datas.shift()}unshift(...e){this._datas.unshift.apply(this._datas,e)}size(){return this._datas.length}isEmpty(){return 0===this._datas.length}add(e,t){void 0===t?this._datas.push(e):this._datas.splice(t,0,e)}addAll(e){if(Array.isArray(e)){const t=e,i=t.length;for(let e=0;e<i;e++)this._datas.push(t[e])}else if(V(e)){const t=e,i=t.size();for(let e=0;e<i;e++)this._datas.push(t.get(e))}}get(e){return this._datas[e]}slice(e,t){return new G(this._datas.slice(e,t))}remove(e){const t=this._datas.indexOf(e);if(t>=0)return this.removeAt(t),t}set(e,t){return this._datas[e]=t}clear(){return this._datas.splice(0,this._datas.length)}contains(e){return this._datas.includes(e)}indexOf(e){return this._datas.indexOf(e)}removeAt(e){return this._datas.splice(e,1)[0]}forEach(e,t){this.each(e,t)}each(e,t){const i=this._datas.length;for(let s=0;s<i;s++){const i=this._datas[s];t?e.call(t,i,s,this):e(i,s,this)}}reverseEach(e,t){for(let i=this._datas.length-1;i>=0;i--){const s=this._datas[i];t?e.call(t,s):e(s)}}getArray(){return this._datas}toArray(e,t){if(e){const i=[],s=this._datas.length;for(let n=0;n<s;n++){const s=this._datas[n];t?e.call(t,s)&&i.push(s):e(s)&&i.push(s)}return i}return this._datas.concat()}toList(e,t){if(e){const i=new G,s=this._datas.length;for(let n=0;n<s;n++){const s=this._datas[n];t?e.call(t,s)&&i.add(s):e(s)&&i.add(s)}return i}return new G(this)}reverse(){this._datas.reverse()}sort(e){return e?this._datas.sort(e):this._datas.sort(),this}toString(){return this._datas.toString()}}class X{constructor(e,t){Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.x=e,this.y=t}add(e){return new X(this.x+e.x,this.y+e.y)}subtract(e){return new X(this.x-e.x,this.y-e.y)}}var Y=function(e,t,i,s){function n(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function r(e){try{l(s.next(e))}catch(t){a(t)}}function o(e){try{l(s["throw"](e))}catch(t){a(t)}}function l(e){e.done?i(e.value):n(e.value).then(r,o)}l((s=s.apply(e,t||[])).next())}))};class ${constructor(e){Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"container",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dataModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_ro",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.createLowerCanvas(),e.editable&&this.initEventListeners()}setDataModel(e){this.dataModel=e,this.dataModel.on("renderAll",(()=>{this.renderAll(),console.info("%crenderAll","color: green")}))}initEventListeners(){const e={x:0,y:0},t=t=>{const s=R(document.body,t);if(this.dataModel){const t=this.dataModel.getDatas(),i=new G;let n;for(let a=0;a<t.size();a++){const i=t.get(a);if("Edge"!==i.className){const t=i.getBounds();D(t,s.x,s.y)&&(e.x=s.x-i.x,e.y=s.y-i.y,n=i)}}n&&i.add(n),0===this.dataModel.getSelection().size()&&0===i.size()||this.dataModel.setSelection(i)}document.addEventListener("mousemove",i,!1)},i=t=>{if(this.dataModel){const i=this.dataModel.getSelection(),s=R(document.body,t);i.size()>0&&i.each((t=>{const i={x:s.x-e.x,y:s.y-e.y};if("Shape"===(null===t||void 0===t?void 0:t.className)){const e=t,s=e.points;e.points=s.map((e=>{const s=new X(e.x,e.y),n=new X(i.x-t.x,i.y-t.y),a=s.add(n);return{x:a.x,y:a.y}}))}t&&(t.x=i.x,t.y=i.y)}))}},s=e=>{document.removeEventListener("mousemove",i,!1)};document.addEventListener("mousedown",t,!1),document.addEventListener("mouseup",s,!1);const n=e=>{const t=R(this.canvas,e);if(this.dataModel){const e=this.dataModel.getDatas();let i;for(let s=0;s<e.size();s++){const n=e.get(s);if("Edge"!==n.className){const e=n.getBounds();if(D(e,t.x,t.y)){i=n;break}}}this.canvas.style.cursor=i?"pointer":"default"}};this.canvas.addEventListener("mousemove",n,!1)}renderAll(){return Y(this,void 0,void 0,(function*(){if(this.dataModel){const e=this.dataModel.getDatas(),t=new Set,i=new Set;e.each((e=>{const s=e,n=s.image;if(n)if(n.endsWith(".json"))w.getImage(n)||t.add(n);else{let e;e=n.startsWith("data:image")?s.displayName:s.image,w.getImage(e)||i.add({name:n,displayName:s.displayName})}})),this.context.save(),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.dataModel.background&&(this.context.fillStyle=this.dataModel.background,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.restore()),t.size>0&&(yield w.loadSymbol(Array.from(t))),i.size>0&&(yield w.loadImage(Array.from(i)));const s=e.size();for(let a=0;a<s;a++){const t=e.get(a),i=t.className;if("Node"===i){const e=t;if(e.image){const t=e.image;if(t.endsWith(".json")){const i=w.getImage(t),s=i.comps;if(s.length){if(!e.symbolLoaded){const t=new Set;s.forEach((e=>{if("image"===e.type){const i=e.name;i.startsWith("data:image")&&!w.getImage(e.displayName)?t.add(e):w.getImage(e.name)||t.add(e)}})),t.size>0&&(yield w.loadImage(Array.from(t)),e.symbolLoaded=!0)}B(this,this.dataModel,e,i)}}else B(this,this.dataModel,e)}else B(this,this.dataModel,e)}else"Edge"===t.className?k(this.context,t):"Text"===i?E(this.context,t):"Shape"===i&&C(this.context,t)}const n=this.dataModel.getSelection();n.each((e=>{e&&z(this,e)})),this.context.restore()}}))}requestRenderAll(){requestAnimationFrame(this.renderAll.bind(this))}fitContent(){}mount(e){this.container=e||document.body,this.container.appendChild(this.canvas),this._ro=new ResizeObserver((e=>{for(const t of e){const{width:e,height:i}=t.contentRect,s=Math.floor(e),n=Math.floor(i);this.canvas.width=s,this.canvas.height=n,this.canvas.style.width=s+"px",this.canvas.style.height=n+"px",this.requestRenderAll()}})),this._ro.observe(this.container)}destory(){this._ro.disconnect()}createLowerCanvas(){const e=document.createElement("canvas");e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.right="0px",e.style.bottom="0px";const t=e.getContext("2d");if(!t)throw new Error("get 2d context failed");return this.context=t,this.canvas=e,this.canvas}}function Z(e){const t={};for(const i in e){const s=e[i];switch(i){case"edge.segments":case"edge.points":t[i]=s.__a;break;default:t[i]=s;break}}return t}class H extends l{constructor(){super(),Object.defineProperty(this,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Edge"}),Object.defineProperty(this,"_styleMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"_source",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_target",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}setStyle(e,t){if(void 0!==t&&"string"===typeof e&&this._styleMap.set(e,t),e&&Object.keys(e).length>0)for(const i in e)this._styleMap.set(i,e[i]);this.update()}getStyle(e){return this._styleMap.get(e)}setSource(e){this._source=e,this.update()}setTarget(e){this._target=e,this.update()}getSource(){return this._source}getTarget(){return this._target}}var K={GraphView:$,Data:l,Node:h,Edge:H,utils:w};class Q{constructor(){Object.defineProperty(this,"_events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isWaiting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this._events=Object.create(null)}on(e,t){if(Array.isArray(e))for(let i=0,s=e.length;i<s;i++)this.on(e[i],t);else(this._events[e]||(this._events[e]=[])).push(t);return this}off(e,t){if(!arguments.length)return this._events=Object.create(null),this;if(Array.isArray(e)){for(let i=0,s=e.length;i<s;i++)this.off(e[i],t);return this}const i=this._events[e];if(!i)return this;if(!t)return this._events[e]=null,this;let s,n=i.length;while(n--)if(s=i[n],s===t||s.fn===t){i.splice(n,1);break}return this}once(e,t){const i=this;function s(){i.off(e,t),t.apply(i,arguments)}return s.fn=t,this.on(e,s),this}emit(e){const t=this._events[e];if(t){const e=Array.from(arguments).slice(1);for(let i=0,s=t.length;i<s;i++)t[i].apply(this,e)}return this}emitNextTick(e){this._isWaiting||(this._isWaiting=!0,requestAnimationFrame((()=>{this.emit(e),this._isWaiting=!1})))}}class ee extends Q{constructor(){super(),Object.defineProperty(this,"_dataList",{enumerable:!0,configurable:!0,writable:!0,value:new G}),Object.defineProperty(this,"_selection",{enumerable:!0,configurable:!0,writable:!0,value:new G}),Object.defineProperty(this,"_idMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"_lastId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_backgrond",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}set background(e){this._backgrond=e,this.emitNextTick("renderAll")}get background(){return this._backgrond}add(e,t){e.dataModel=this,e.id?this._lastId=e.id:this._lastId?(this._lastId+=1,e.id=this._lastId):(e.id=U(),this._lastId=e.id),this._dataList.add(e,t),this._idMap.set(e.id,e),this.emitNextTick("renderAll")}getDataById(e){return this._idMap.get(e)}getDatas(){return this._dataList}getSelection(){return this._selection}setSelection(e){this._selection.clear();const t=e.size();for(let i=0;i<t;i++){const t=e.get(i);this._selection.push(t)}this.emitNextTick("renderAll")}deserialize(e){const t=e.d,i=e.p;i&&(this.background=i.background);const s=t.length;if(s>0){const e=new Array(s).fill(null);for(let i=0;i<t.length;i++){const s=t[i],n=s.p,a=s.c,r=a.indexOf("."),o=a.substr(r+1),l=s.i;if("Node"===o&&!this.getDataById(l)){const e=F(s);this.add(e,i)}if("Text"==o){const e=J(s);this.add(e,i)}if("Edge"===o){const a=new H;if(s.s){const e=Z(s.s);a.setStyle(e)}a.id=s.i,a.dataModel=this,this.add(a,i),e[i]=a;const{source:r,target:o}=n,l=this.getDataById(r.__i);if(l)a.setSource(l);else{const e=t.findIndex((e=>e.i===r.__i));if(-1===e)continue;const i=t[e],s=F(i);this.add(s,e),a.setSource(s)}const h=this.getDataById(o.__i);if(h)a.setTarget(h);else{const e=t.findIndex((e=>e.i===o.__i));if(-1===e)continue;const i=t[e],s=F(i);this.add(s,e),a.setTarget(s)}}if("Shape"===o){const e=q(s);this.add(e,i)}}}}}var te=function(e,t,i,s){function n(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function r(e){try{l(s.next(e))}catch(t){a(t)}}function o(e){try{l(s["throw"](e))}catch(t){a(t)}}function l(e){e.done?i(e.value):n(e.value).then(r,o)}l((s=s.apply(e,t||[])).next())}))},ie=(0,n.aZ)({name:"App",components:{},mounted(){return te(this,void 0,void 0,(function*(){K.utils.convertURL=function(e){return`storage/${e}`};const e=yield K.utils.load("displays/basic.json"),t=new K.GraphView({editable:!0}),i=new ee;t.setDataModel(i),i.deserialize(e),window.dm=i,window.gv=t,window.graph=K;const s=new K.Node;s.image="symbols/demo/image.json",s.x=200,s.y=200,s.width=352.19811,s.height=352.19811,t.mount(this.$el)}))}});ie.render=r;var se=ie;const ne=(0,s.ri)(se);ne.mount("#app")}},t={};function i(s){var n=t[s];if(void 0!==n)return n.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,i),a.exports}i.m=e,function(){var e=[];i.O=function(t,s,n,a){if(!s){var r=1/0;for(c=0;c<e.length;c++){s=e[c][0],n=e[c][1],a=e[c][2];for(var o=!0,l=0;l<s.length;l++)(!1&a||r>=a)&&Object.keys(i.O).every((function(e){return i.O[e](s[l])}))?s.splice(l--,1):(o=!1,a<r&&(r=a));if(o){e.splice(c--,1);var h=n();void 0!==h&&(t=h)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[s,n,a]}}(),function(){i.d=function(e,t){for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};i.O.j=function(t){return 0===e[t]};var t=function(t,s){var n,a,r=s[0],o=s[1],l=s[2],h=0;for(n in o)i.o(o,n)&&(i.m[n]=o[n]);if(l)var c=l(i);for(t&&t(s);h<r.length;h++)a=r[h],i.o(e,a)&&e[a]&&e[a][0](),e[r[h]]=0;return i.O(c)},s=self["webpackChunkgraph"]=self["webpackChunkgraph"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=i.O(void 0,[998],(function(){return i(759)}));s=i.O(s)})();